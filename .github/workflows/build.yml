name: Build EXE

on:
  workflow_dispatch: # ম্যানুয়ালি বিল্ড শুরু করার বাটন দেবে

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        if (Test-Path requirements.txt) {
            pip install -r requirements.txt
        }
        # আপনার প্রয়োজন হলে এখানে বাড়তি লাইব্রেরি যোগ করুন:
        # pip install customtkinter requests pillow

    - name: Locate Script and Build
      run: |
        # ফাইলটি যদি সরাসরি মেইন ফোল্ডারে না থাকে, তবে এটি সব ফোল্ডার সার্চ করবে
        $scriptPath = Get-ChildItem -Filter "ExtractorGUI.py" -Recurse | Select-Object -First 1 -ExpandProperty FullName
        
        if (-not $scriptPath) {
            # যদি বড় হাতের নামে না পাওয়া যায়, তবে ছোট হাতের নামে চেক করবে
            $scriptPath = Get-ChildItem -Filter "extractorgui.py" -Recurse | Select-Object -First 1 -ExpandProperty FullName
        }

        if ($scriptPath) {
            echo "Found script at: $scriptPath"
            pyinstaller --onefile --noconsole --clean $scriptPath
        } else {
            echo "ERROR: Could not find ExtractorGUI.py or extractorgui.py in the repository."
            exit 1
        }

    - name: Verify Build
      run: |
        if (Test-Path dist/*.exe) {
            echo "Build successful."
        } else {
            echo "Build failed: Output EXE not found."
            exit 1
        }

    - name: Upload EXE Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ExtractorGUI-Windows-Build
        path: dist/*.exe
        retention-days: 7
